#!/bin/bash

# if first argument is -h or --help, print usage and exit
if [[ "$1" == "-h" || "$1" == "--help" ]]; then
    echo "Usage: $0 [OPTION]"
    echo "Options:"
    echo "  -h, --help: print this help and exit"
    echo "  -i, --interactive: start interactive mode"
    exit 0
fi

# if the first argument is -i then ask for a password in a prompt and save it in the first argument
if [[ "$1" == "-i" || "$1" == "--interactive" ]]; then
    echo -n "Enter password: "
    read -s PASSWORD
    echo
    echo -n "Enter password again: "
    read -s RE_PASSWORD
    echo
    if [ "$PASSWORD" != "$RE_PASSWORD" ]; then
        echo "Passwords do not match"
        exit 1
    fi
    $1="$PASSWORD"
fi


# check if the first argument is a string and the length is greater than 7
if [ $# -eq 0 ] || [ $1 == "-h" ] || [ $1 == "--help" ] || [ ${#1} -lt 7 ]; then
    echo "Usage: codep <password>"
    echo "The password needs to be a string with at least 7 characters."
    exit 1
fi

echo "Generate hash..."
codepr "$(sha256sum2 "$NEWPASSWORD")"